language: python

sudo: false

cache:
  - pip

python:
  - "2.7"
  - "3.5"

env:
  - DJANGO_VERSION=1.10 DATABASE_SETTINGS='settings_local.py'
  - DJANGO_VERSION=1.11rc1 DATABASE_SETTINGS='settings_local.py'

install:
 - pip install -r requirements.txt
 - pip uninstall -y Django
 - pip install -q Django==$DJANGO_VERSION

before_script:
  - psql -c 'create database access_mo_django;' -U postgres
  - psql -c "CREATE EXTENSION postgis;" -U postgres -d access_mo_django

script:
  - flake8 am
  - python am/manage.py migrate
  - coverage run am/manage.py test house_scraper
  - coverage run am/manage.py test senate_scraper

after_success:
  - coveralls

addons:
  postgresql: "9.4"
